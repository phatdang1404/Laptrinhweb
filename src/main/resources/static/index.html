<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>Quản lý sinh viên</title>
    <link rel="stylesheet"
          href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">
</head>
<body class="container mt-4">

<h3>DANH SÁCH SINH VIÊN</h3>

<input type="text" id="search" class="form-control mb-3"
       placeholder="Tìm theo tên..." onkeyup="searchStudent()">

<table class="table table-bordered">
    <thead class="table-dark">
    <tr>
        <th>ID</th>
        <th>Tên</th>
        <th>Email</th>
        <th>Hành động</th>
    </tr>
    </thead>
    <tbody id="studentTable"></tbody>
</table>

<hr>

<h4 id="formTitle">Thêm sinh viên</h4>

<input id="id" class="form-control mb-2" placeholder="ID" disabled>
<input id="name" class="form-control mb-2" placeholder="Tên">
<input id="email" class="form-control mb-2" placeholder="Email">

<button class="btn btn-primary" onclick="saveStudent()">Lưu</button>
<button class="btn btn-secondary ms-2" onclick="resetForm()">Hủy</button>

<script>
const API = "http://localhost:8080/api/students";

/* ================= LOAD ================= */
function loadStudents() {
    fetch(API)
        .then(res => res.json())
        .then(data => {
            let html = "";
            data.forEach(s => {
                html += `
                <tr>
                    <td>${s.id}</td>
                    <td>${s.name}</td>
                    <td>${s.email}</td>
                    <td>
                        <button class="btn btn-warning btn-sm"
                            onclick="editStudent(${s.id}, '${s.name}', '${s.email}')">
                            Sửa
                        </button>
                        <button class="btn btn-danger btn-sm ms-2"
                            onclick="deleteStudent(${s.id})">
                            Xóa
                        </button>
                    </td>
                </tr>`;
            });
            document.getElementById("studentTable").innerHTML = html;
        });
}

/* ================= ADD / UPDATE ================= */
function saveStudent() {
    const id = document.getElementById("id").value;
    const student = {
        name: document.getElementById("name").value,
        email: document.getElementById("email").value
    };

    if (id) {
        // UPDATE
        fetch(`${API}/${id}`, {
            method: "PUT",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(student)
        }).then(() => {
            resetForm();
            loadStudents();
        });
    } else {
        // ADD
        fetch(API, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(student)
        }).then(() => {
            resetForm();
            loadStudents();
        });
    }
}

/* ================= EDIT ================= */
function editStudent(id, name, email) {
    document.getElementById("id").value = id;
    document.getElementById("name").value = name;
    document.getElementById("email").value = email;
    document.getElementById("formTitle").innerText = "Cập nhật sinh viên";
}

/* ================= DELETE ================= */
function deleteStudent(id) {
    if (confirm("Bạn có chắc muốn xóa sinh viên này?")) {
        fetch(`${API}/${id}`, { method: "DELETE" })
            .then(() => loadStudents());
    }
}

/* ================= SEARCH ================= */
function searchStudent() {
    const name = document.getElementById("search").value;
    if (name === "") {
        loadStudents();
        return;
    }

    fetch(`${API}/search?name=${name}`)
        .then(res => res.json())
        .then(data => {
            let html = "";
            data.forEach(s => {
                html += `
                <tr>
                    <td>${s.id}</td>
                    <td>${s.name}</td>
                    <td>${s.email}</td>
                    <td></td>
                </tr>`;
            });
            document.getElementById("studentTable").innerHTML = html;
        });
}

/* ================= RESET FORM ================= */
function resetForm() {
    document.getElementById("id").value = "";
    document.getElementById("name").value = "";
    document.getElementById("email").value = "";
    document.getElementById("formTitle").innerText = "Thêm sinh viên";
}

loadStudents();
</script>

</body>
</html>
